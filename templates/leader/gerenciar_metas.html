{% extends "base.html" %}

{% block title %}Gerenciar Metas - GeRot{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">üéØ Gerenciar Metas</h1>
    
    <!-- Vis√£o Geral -->
    <div class="overview-grid">
        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-content">
                <h3>Total de Metas</h3>
                <div class="stat-number">{{ stats.total_goals }}</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-content">
                <h3>Conclu√≠das</h3>
                <div class="stat-number">{{ stats.completed_goals }}</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚è≥</div>
            <div class="stat-content">
                <h3>Em Andamento</h3>
                <div class="stat-number">{{ stats.in_progress_goals }}</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚ö†Ô∏è</div>
            <div class="stat-content">
                <h3>Atrasadas</h3>
                <div class="stat-number">{{ stats.overdue_goals }}</div>
            </div>
        </div>
    </div>
    
    <!-- Lista de Metas -->
    <div class="card mt-4">
        <div class="card-header">
            <h2>üìã Metas da Equipe</h2>
            <button class="btn btn-primary" onclick="abrirModalMeta()">
                <i class="fas fa-plus"></i> Nova Meta
            </button>
        </div>
        
        {% if metas %}
        <div class="goals-list">
            {% for meta in metas %}
            <div class="goal-card">
                <div class="goal-status {{ meta.status }}">
                    <span class="status-dot"></span>
                    {{ meta.status|title }}
                </div>
                
                <div class="goal-content">
                    <h3>{{ meta.title }}</h3>
                    <p>{{ meta.description }}</p>
                    
                    <div class="goal-meta">
                        <div class="meta-item">
                            <i class="fas fa-users"></i>
                            {{ meta.team_name }}
                        </div>
                        
                        <div class="meta-item">
                            <i class="fas fa-calendar"></i>
                            {{ meta.end_date }}
                        </div>
                        
                        <div class="meta-item">
                            <i class="fas fa-chart-line"></i>
                            {{ meta.target_value }} {{ meta.unit }}
                        </div>
                    </div>
                    
                    <div class="progress-section">
                        <div class="progress-info">
                            <span>Progresso</span>
                            <span>{{ (meta.current_value / meta.target_value * 100)|round }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: {{ (meta.current_value / meta.target_value * 100)|round }}%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="goal-actions">
                    <button class="btn btn-info btn-sm" onclick="editarMeta('{{ meta.id }}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-success btn-sm" onclick="atualizarProgresso('{{ meta.id }}')">
                        <i class="fas fa-chart-line"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="excluirMeta('{{ meta.id }}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="icon">üéØ</div>
            <h3>Nenhuma Meta Cadastrada</h3>
            <p>Comece criando metas para sua equipe!</p>
            <button class="btn btn-primary" onclick="abrirModalMeta()">
                <i class="fas fa-plus"></i> Criar Primeira Meta
            </button>
        </div>
        {% endif %}
    </div>
</div>

<!-- Modal de Meta -->
<div class="modal" id="modalMeta">
    <div class="modal-content">
        <h2>Nova Meta</h2>
        <form id="formMeta" method="POST">
            <div class="form-group">
                <label for="title">T√≠tulo*</label>
                <input type="text" id="title" name="title" required>
            </div>
            
            <div class="form-group">
                <label for="description">Descri√ß√£o</label>
                <textarea id="description" name="description" rows="4"></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="target_value">Valor Alvo*</label>
                    <input type="number" id="target_value" name="target_value" required>
                </div>
                
                <div class="form-group">
                    <label for="unit">Unidade</label>
                    <input type="text" id="unit" name="unit" placeholder="Ex: vendas, %">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="start_date">Data In√≠cio*</label>
                    <input type="date" id="start_date" name="start_date" required>
                </div>
                
                <div class="form-group">
                    <label for="end_date">Data Fim*</label>
                    <input type="date" id="end_date" name="end_date" required>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
                <button type="submit" class="btn btn-primary">Salvar Meta</button>
            </div>
        </form>
    </div>
</div>

<style>
.overview-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.stat-card {
    background: white;
    border-radius: 10px;
    padding: 1.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    gap: 1rem;
}

.stat-icon {
    font-size: 2rem;
}

.stat-content {
    flex: 1;
}

.stat-content h3 {
    margin: 0;
    font-size: 1rem;
    color: #6c757d;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    margin-top: 0.5rem;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.goals-list {
    display: grid;
    gap: 1rem;
}

.goal-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1.5rem;
    position: relative;
}

.goal-status {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.3rem 0.8rem;
    border-radius: 15px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: currentColor;
}

.goal-status.concluida {
    background: #d4edda;
    color: #155724;
}

.goal-status.em_andamento {
    background: #fff3cd;
    color: #856404;
}

.goal-status.atrasada {
    background: #f8d7da;
    color: #721c24;
}

.goal-content h3 {
    margin: 0;
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
}

.goal-meta {
    display: flex;
    gap: 1.5rem;
    margin: 1rem 0;
    color: #6c757d;
    font-size: 0.9rem;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.progress-section {
    margin-top: 1rem;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.progress-bar {
    height: 6px;
    background: #e9ecef;
    border-radius: 3px;
    overflow: hidden;
}

.progress {
    height: 100%;
    background: #007bff;
    transition: width 0.3s ease;
}

.goal-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    width: 100%;
    max-width: 500px;
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    margin-top: 1rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
function abrirModalMeta() {
    document.getElementById('modalMeta').style.display = 'flex';
}

function fecharModal() {
    document.getElementById('modalMeta').style.display = 'none';
}

function editarMeta(metaId) {
    // Implementar edi√ß√£o
    alert('Editar meta ' + metaId);
}

function atualizarProgresso(metaId) {
    // Implementar atualiza√ß√£o de progresso
    alert('Atualizar progresso da meta ' + metaId);
}

function excluirMeta(metaId) {
    if (confirm('Tem certeza que deseja excluir esta meta?')) {
        // Implementar exclus√£o
        alert('Excluir meta ' + metaId);
    }
}

// Fechar modal ao clicar fora
window.onclick = function(event) {
    if (event.target == document.getElementById('modalMeta')) {
        fecharModal();
    }
}
</script>
{% endblock %} 