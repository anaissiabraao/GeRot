{% extends "base.html" %}

{% block title %}Delegar Tarefas - GeRot{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">üìã Delegar Tarefas</h1>
    
    <div class="grid-layout">
        <!-- Membros da Equipe -->
        <div class="card">
            <h2>üë• Membros da Equipe</h2>
            
            {% if membros %}
            <div class="members-grid">
                {% for membro in membros %}
                <div class="member-card">
                    <div class="member-avatar">{{ membro.nome_completo[0]|upper }}</div>
                    <div class="member-info">
                        <h3>{{ membro.nome_completo }}</h3>
                        <div class="member-stats">
                            <div class="stat">
                                <span class="label">Total Tarefas</span>
                                <span class="value">{{ membro.total_tasks }}</span>
                            </div>
                            <div class="stat">
                                <span class="label">Pendentes</span>
                                <span class="value">{{ membro.pending_tasks }}</span>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="delegarTarefa('{{ membro.id }}', '{{ membro.nome_completo }}')">
                            <i class="fas fa-plus"></i> Delegar Tarefa
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="icon">üë•</div>
                <h3>Nenhum Membro Encontrado</h3>
                <p>Voc√™ ainda n√£o tem membros em sua equipe.</p>
            </div>
            {% endif %}
        </div>
        
        <!-- Tarefas Delegadas -->
        <div class="card">
            <h2>‚úÖ Tarefas Delegadas</h2>
            
            {% if tarefas %}
            <div class="tasks-list">
                {% for tarefa in tarefas %}
                <div class="task-card">
                    <div class="task-header">
                        <h3>{{ tarefa.title }}</h3>
                        <span class="badge badge-{{ 'success' if tarefa.status == 'concluida' else 'warning' if tarefa.status == 'em_andamento' else 'secondary' }}">
                            {{ tarefa.status|title }}
                        </span>
                    </div>
                    
                    <div class="task-body">
                        <p>{{ tarefa.description }}</p>
                        <div class="task-meta">
                            <div class="meta-item">
                                <i class="fas fa-user"></i>
                                {{ tarefa.assigned_to_name }}
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-calendar"></i>
                                {{ tarefa.created_at }}
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-flag"></i>
                                {{ 'Alta' if tarefa.priority == 3 else 'M√©dia' if tarefa.priority == 2 else 'Baixa' }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="task-actions">
                        <button class="btn btn-info btn-sm" onclick="editarTarefa('{{ tarefa.id }}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="excluirTarefa('{{ tarefa.id }}')">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="icon">üìù</div>
                <h3>Nenhuma Tarefa Delegada</h3>
                <p>Delegue tarefas para os membros da sua equipe!</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Modal de Delegar Tarefa -->
<div class="modal" id="modalDelegarTarefa">
    <div class="modal-content">
        <h2>Nova Tarefa</h2>
        <form id="formDelegarTarefa" method="POST">
            <input type="hidden" id="member_id" name="member_id">
            
            <div class="form-group">
                <label for="title">T√≠tulo*</label>
                <input type="text" id="title" name="title" required>
            </div>
            
            <div class="form-group">
                <label for="description">Descri√ß√£o</label>
                <textarea id="description" name="description" rows="4"></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="priority">Prioridade</label>
                    <select id="priority" name="priority">
                        <option value="1">Baixa</option>
                        <option value="2">M√©dia</option>
                        <option value="3">Alta</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="due_date">Data de Entrega</label>
                    <input type="date" id="due_date" name="due_date">
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
                <button type="submit" class="btn btn-primary">Delegar Tarefa</button>
            </div>
        </form>
    </div>
</div>

<style>
.grid-layout {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin: 2rem 0;
}

.members-grid {
    display: grid;
    gap: 1rem;
}

.member-card {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    align-items: center;
}

.member-avatar {
    width: 50px;
    height: 50px;
    background: #007bff;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: bold;
}

.member-info {
    flex: 1;
}

.member-info h3 {
    margin: 0;
    font-size: 1.1rem;
}

.member-role {
    color: #6c757d;
    font-size: 0.9rem;
    margin: 0.2rem 0;
}

.member-stats {
    display: flex;
    gap: 1rem;
    margin: 0.5rem 0;
}

.stat {
    display: flex;
    flex-direction: column;
    font-size: 0.9rem;
}

.stat .label {
    color: #6c757d;
}

.stat .value {
    font-weight: bold;
}

.tasks-list {
    display: grid;
    gap: 1rem;
}

.task-card {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1rem;
}

.task-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.task-header h3 {
    margin: 0;
    font-size: 1.1rem;
}

.task-body {
    font-size: 0.9rem;
}

.task-meta {
    display: flex;
    gap: 1rem;
    margin-top: 0.5rem;
    color: #6c757d;
    font-size: 0.8rem;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.task-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    width: 100%;
    max-width: 500px;
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    margin-top: 1rem;
}

@media (max-width: 768px) {
    .grid-layout {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
function delegarTarefa(memberId, memberName) {
    document.getElementById('member_id').value = memberId;
    document.getElementById('modalDelegarTarefa').style.display = 'flex';
}

function fecharModal() {
    document.getElementById('modalDelegarTarefa').style.display = 'none';
}

function editarTarefa(tarefaId) {
    // Implementar edi√ß√£o
    alert('Editar tarefa ' + tarefaId);
}

function excluirTarefa(tarefaId) {
    if (confirm('Tem certeza que deseja excluir esta tarefa?')) {
        // Implementar exclus√£o
        alert('Excluir tarefa ' + tarefaId);
    }
}

// Fechar modal ao clicar fora
window.onclick = function(event) {
    if (event.target == document.getElementById('modalDelegarTarefa')) {
        fecharModal();
    }
}
</script>
{% endblock %} 